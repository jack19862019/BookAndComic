<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.SysBookMapper">
	<resultMap type="SysBook" id="SysBookResult">
		<id     property="id"       column="id"      />
		<result property="title"       column="title"      />
		<result property="category"    column="category"   />
		<result property="author"     column="author"    />
		<result property="summary"     column="summary"    />
		<result property="coverPic"        column="coverPic"        />
		<result property="detailPic"  column="detailPic"  />
		<result property="sort"          column="sort"          />
		<result property="status"       column="status"       />
		<result property="states"       column="states"       />
		<result property="createTime"   column="create_time"  />
		<result property="updateTime"   column="update_time"  />
	</resultMap>
	<sql id="selectBookVo">
        select * from sys_book b
    </sql>

	<select id="selectBookList" parameterType="SysBook" resultMap="SysBookResult">
		select * from sys_book b where 1=1
		<if test="title != null and title != ''">
			AND b.title like concat('%', #{title}, '%')
		</if>
		<if test="author != null and author != ''">
			AND b.author like concat('%', #{author}, '%')
		</if>
		<if test="states != null and states != ''">
			AND b.states = #{states}
		</if>
		<if test="status != null and status != ''">
			AND b.status = #{status}
		</if>
		<!-- 数据范围过滤 -->
		${params.dataScope}
	</select>
	
	<select id="checkTitleUnique" parameterType="String" resultType="int">
		select count(1) from sys_book where title=#{title}
	</select>

	
	<select id="selectBookById" parameterType="String" resultMap="SysBookResult">
		<include refid="selectBookVo"/>
		where b.id = #{id}
	</select>
	
	<delete id="deleteBookById" parameterType="String">
 		update sys_book set states = '2' where id = #{ids}
 	</delete>

 	
 	<insert id="insertBook" parameterType="SysBook" useGeneratedKeys="true" keyProperty="id">
 		insert into sys_book(
 			<if test="title != null and title != ''">title,</if>
			<if test="author != null and author != ''">category,</if>
 			<if test="author != null and author != ''">author,</if>
 			<if test="summary != null and summary != ''">summary,</if>
 			<if test="coverPic != null and coverPic != ''">coverPic,</if>
 			<if test="detailPic != null and detailPic != ''">detailPic,</if>
 			sort,
 			status,
 			create_time
 		)values(
 			<if test="title != null and title != ''">#{title},</if>
			<if test="author != null and author != ''">#{category},</if>
			<if test="author != null and author != ''">#{author},</if>
			<if test="summary != null and summary != ''">#{summary},</if>
			<if test="coverPic != null and coverPic != ''">#{coverPic},</if>
			<if test="detailPic != null and detailPic != ''">#{detailPic},</if>
			#{sort},
			#{status},
 			sysdate()
 		)
	</insert>
	
</mapper> 